# 缺陷记录与修复模板

## 1. 缺陷基础信息
- `Bug ID`：
- `标题`：
- `报告日期`：
- `发现人`：
- `所属版本/迭代`：
- `严重级别 (S0 / S1 / S2 / S3)`：
- `优先级 (P0 / P1 / P2 / P3)`：
- `状态 (新建 / 待确认 / 处理中 / 待验证 / 已关闭 / 延期 / 拒绝)`：
- `关联需求 / 任务`：

## 2. 运行环境
- `操作系统 / 浏览器 / 客户端版本`：
- `部署环境`（测试 / 预发 / 生产 等）：
- `服务版本 / 构建号`：
- `依赖服务或配置`：
- `数据准备 / 账号信息`：

## 3. 复现步骤
1. 
2. 
3. 

> **预期结果**：
> 
> **实际结果**：

## 4. 补充信息
- `日志 / 截图 / 视频 / 报警链接`：
- `自动化流水线编号`（若由 CI/CD 发现）：
- `临时规避方案`：

## 5. 修复方案与实现
- `根因分析`：
- `修复思路`：
- `涉及代码 / 配置改动`：
- `回退方案`：

## 6. 验证与回归
- `开发自测`：
  - 单元测试：
  - 集成 / 联调：
- `测试验证人`：
- `验证日期`：
- `验证结果`：通过 / 未通过（原因：）
- `回归范围 / 自动化用例`：

## 7. 关闭确认
- `关闭日期`：
- `关闭人`：
- `上线批次 / 发布窗口`：
- `监控与告警`：是否新增或更新
- `知识库链接`：复盘记录 / 技术文章

---

### 附录：严重级别参考
- **S0 阻塞**：影响核心业务或数据安全，系统无法运行，必须立即修复。
- **S1 严重**：主要功能受阻或产生严重异常，需在当前迭代内优先处理。
- **S2 一般**：功能存在缺陷但有替代路径，对体验有明显影响。
- **S3 轻微**：轻量级问题，如交互提示、UI 对齐、文案等。

> 建议结合团队工具链（如 Jira、Tapd 等）建立标准化缺陷单，确保上述字段全部覆盖。

---

## 当前缺陷记录

### 待确认 Bug 清单
- 移动端适配
- Virtual Group - flex 元素到底是为什么产生

### 已登记 Bug 列表
| Bug ID | 标题 | 报告日期 | 严重级别 | 优先级 | 状态 | 复现步骤 | 预期结果 | 实际结果 | 验证结果 | 关闭日期 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Bug-001 | 未考虑嵌套路由 | 2025-09-29 | S0 阻塞 | P0 | 处理中 | 1. 使用当前路由生成逻辑<br>2. 配置嵌套路由<br>3. 生成结果错误 | 支持嵌套路由配置 | 嵌套路由未生成或错误 |  |  |
| Bug-002 | 颜色没渲染出来 | 2025-01-27 | S1 严重 | P1 | 新建 | 1. 使用 DSL 生成前端项目<br>2. 启动项目并访问页面<br>3. 检查页面元素颜色渲染情况 | 所有 DSL 节点都应正确渲染颜色样式 | 元素颜色未正确显示或显示异常 |  |  |
| Bug-003 | `src` 目录缺少路径别名 | 2025-09-29 | S2 一般 | P1 | 新建 | 1. 查看前端模板配置<br>2. 尝试在模块引入中使用 `@/` 或 `src/` 别名<br>3. 编译报错显示未解析的路径别名 | 模块引用支持统一的路径别名 | 模块必须使用相对路径，维护成本高 |  |  |
| Bug-004 | DSL 根节点区分缺失 | 2025-09-29 | S0 阻塞 | P0 | 已关闭 | 1. 在 DSL 输入中加载页面结构<br>2. 检查节点层级信息<br>3. 无法标记根节点 | DSL 能识别并标注根节点 | 所有节点缺少根节点信息 | 通过 | 2025-09-29 |
| Bug-005 | `router.path` 值异常 | 2025-09-29 | S0 阻塞 | P0 | 已关闭 | 1. 生成代码<br>2. 检查生成的 `router.path`<br>3. 与预期不符 | `router.path` 与页面配置一致 | `router.path` 错误 | 通过 | 2025-09-29 |
| Bug-006 | `router.tsx` 语法错误 | 2025-09-29 | S0 阻塞 | P0 | 已关闭 | 1. 生成路由文件<br>2. 打开 `router.tsx`<br>3. 编译时报语法错误 | `router.tsx` 符合语法规范 | 存在语法错误导致编译失败 | 通过 | 2025-09-29 |
| Bug-007 | TSX 样式缺少 px 单位 | 2025-09-29 | S2 一般 | P1 | 已关闭 | 1. 生成前端代码<br>2. 打开页面组件 TSX 文件<br>3. 检查内联样式数值未带单位 | 样式数值应自动补全 `px` 等单位 | 数值样式直接输出裸数字导致渲染不符 | 通过 | 2025-09-29 |
| Bug-008 | 生成项目未渲染路由 | 2025-09-29 | S0 阻塞 | P0 | 已关闭 | 1. 生成项目并启动 dev 服务器<br>2. 访问根路径<br>3. 页面无内容且 console 显示路由未挂载 | 默认渲染 router 中的首个页面路由 | 项目启动后无法渲染任何路由页面 | 通过 | 2025-09-29 |
| Bug-009 | 内联样式语法错误 | 2025-09-29 | S0 阻塞 | P0 | 已关闭 | 1. 生成项目并打开 TSX 组件文件<br>2. 检查自动生成的 `style` 对象<br>3. 编译时报内联样式语法错误 | 生成的内联样式应符合 React 语法规范 | 自动生成的样式字段非法导致编译失败 | 通过 | 2025-09-29 |
| Bug-010 | 根目录第一个节点不应使用绝对定位 | 2025-01-27 | S2 一般 | P1 | 新建 | 1. 使用 DSL 生成前端项目<br>2. 检查根目录下第一个节点（页面级组件）的样式<br>3. 发现使用了绝对定位 | 页面级组件应使用相对定位或流式布局 | 根目录第一个节点错误地使用了绝对定位 |  |  |
| Bug-011 | 全局样式丢失：未提供令牌文件时跳过所有样式解析 | 2025-10-09 | S1 严重 | P0 | 已关闭 | 1. 运行一个不带 design_tokens.json 文件的 Sketch 到 DSL 的转换任务。<br>2. 检查输出的 dsl.json 文件。 | 即使没有令牌文件，节点也应包含从源文件解析出的原始样式值（如背景色、文字颜色等）。 | 所有节点的 style 对象都只包含 width 和 height，所有其他样式信息全部丢失。 | 通过 | 2025-10-09 |
| Bug-012 | 文本内容丢失：解析器从错误的字段读取文本 | 2025-10-09 | S1 严重 | P0 | 新建 | 1. 运行一个包含文本节点的 Sketch 到 DSL 的转换任务。<br>2. 检查输出 dsl.json 中对应的 text 节点。 | text 节点的 content.text 字段应包含源文件中定义的字符串。 | text 节点的 content.text 字段为 null。 | | |
| Bug-013 | 代码生成器忽略DSL中的Flex布局规则 | 2025-10-09 | S1 严重 | P0 | 已关闭 | 1. 使用一个包含 layout.type 为 'flex' 的 DSL 文件生成前端代码。<br>2. 检查生成的 TSX 组件代码。 | 包含 layout.type: 'flex' 的 div 应该生成包含 'display: "flex"', 'flexDirection: "..."' 等样式的代码。 | 生成的 style 对象中完全没有 flex 布局相关的样式，layout 对象中的 flex 规则被忽略。 | 通过 | 2025-10-09 |
| Bug-014 | LLM布局模式下，子节点未按视觉顺序排序 | 2025-10-09 | S2 一般 | P2 | 处理中 | 1. 使用一个其子节点可被LLM识别为单一Flex布局（行或列）的Sketch文件进行转换。<br>2. 确保文件中子图层的列表顺序与它们在画布上的视觉顺序不一致。<br>3. 检查生成的代码（如TSX文件）。 | 生成的代码中，Flex容器内的子元素DOM顺序应与其在画布上的视觉顺序（从上到下或从左到右）一致。 | 子元素的DOM顺序与其在Sketch文件内部的图层列表顺序一致，而非正确的视觉顺序，导致最终渲染的页面元素排序错误。 | **根因**: Bug仅存在于使用LLM进行布局分析的路径中。当LLM将一组子节点识别为单一Flex布局时（`is_simple_group`为true），代码会直接遍历原始的、未排序的图层列表来生成子节点。而不使用LLM的规则路径（`_analyze_layout_with_rules`）因为对图层列表进行了就地排序，所以没有此Bug。<br>**修复思路**: 在LLM分析为“简单布局”的代码分支中，增加一步排序逻辑：在遍历子图层列表之前，根据LLM返回的布局方向（`row`或`column`），使用其`frame`的`x`或`y`坐标对列表进行排序。 | |
| Bug-015 | 容器节点未被转换为Flex容器 | 2025-10-09 | S2 一般 | P1 | 已关闭 | 1. 使用一个其子节点可被LLM识别为Flex布局的容器节点进行转换。<br>2. 检查输出的DSL和最终生成的代码。 | 父容器节点本身应被赋予 'layout: { type: "flex", ... }' 属性，并在生成的代码中获得 'display: "flex"' 样式。 | 父容器未获得Flex属性。系统创建了一个多余的 'Virtual Group' 子节点来承载Flex布局，并使用绝对定位，导致DOM结构和布局不正确。 | 通过 | 2025-10-09 |
